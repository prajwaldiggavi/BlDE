<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>IIIT-V | Faculty</title>
    <link rel="icon" type="image/png" href="img/IIITV_Logo_1x1_small.png">
    <link href='https://fonts.googleapis.com/css?family=Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="n.css">
    <style>
        body { background-color: #f8f9fa; }
        .container { margin-top: 20px; }
        .btn:hover { background-color: #0056b3; transform: scale(1.05); }
        table { margin-top: 20px; }
        footer { background-color: #a8e6cf; text-align: center; padding: 10px 0; margin-top: 20px; }
    </style>
</head>

<body>
    <div class="container">
        <h2>Student Details Entry</h2>
        <form id="studentForm">
            <input type="text" class="form-control" id="studentId" placeholder="Student USN" required>
            <input type="text" class="form-control" id="studentName" placeholder="Student Name" required>
            <select class="form-control" id="semester" required>
                <option value="">--Select Semester--</option>
                <option value="1">Semester 1</option>
                <option value="2">Semester 2</option>
                <option value="3">Semester 3</option>
                <option value="4">Semester 4</option>
                <option value="5">Semester 5</option>
                <option value="6">Semester 6</option>
                <option value="7">Semester 7</option>
                <option value="8">Semester 8</option>
            </select>
            <input type="text" class="form-control" id="phone_number" placeholder="Phone Number" required>
            <input type="email" class="form-control" id="email" placeholder="Email" required>
            <input type="date" class="form-control" id="dob" required>
            <select class="form-control" id="gender" required>
                <option value="">--Select Gender--</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <button type="button" class="btn btn-primary" onclick="addStudent()">Add Student</button>
        </form>

        <hr>
        <h2>Show Students</h2>
        <select class="form-control" id="showSemester" required>
            <option value="">--Select Semester--</option>
            <option value="1">Semester 1</option>
            <option value="2">Semester 2</option>
            <option value="3">Semester 3</option>
            <option value="4">Semester 4</option>
            <option value="5">Semester 5</option>
            <option value="6">Semester 6</option>
            <option value="7">Semester 7</option>
            <option value="8">Semester 8</option>
        </select>
        <button type="button" class="btn btn-success" onclick="showStudents()">Show Students</button>

        <table class="table table-striped" id="studentTable">
            <thead>
                <tr>
                    <th>USN</th>
                    <th>Name</th>
                    <th>Semester</th>
                    <th>Phone Number</th>
                    <th>Email</th>
                    <th>Date of Birth</th>
                    <th>Gender</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="studentList"></tbody>
        </table>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        const serverUrl = 'https://blde-production.up.railway.app';

        function addStudent() {
            const student = {
                studentId: $('#studentId').val(),
                studentName: $('#studentName').val(),
                semester: $('#semester').val(),
                phone_number: $('#phone_number').val(),
                email: $('#email').val(),
                dob: $('#dob').val(),
                gender: $('#gender').val()
            };

            if (Object.values(student).some(val => !val)) {
                alert('Please fill out all required fields.');
                return;
            }

            $.post(`${serverUrl}/add-student`, JSON.stringify(student), (response) => {
                alert(response);
                $('#studentForm')[0].reset();
                showStudents();
            }).fail(error => alert('Error: ' + error.responseText));
        }

        function showStudents() {
            const semester = $('#showSemester').val();
            if (!semester) return alert('Please select a semester.');

            $.get(`${serverUrl}/students/${semester}`, (students) => {
                $('#studentList').empty();
                students.length > 0 ? students.forEach(student => {
                    $('#studentList').append(`
                        <tr id="row-${student.studentId}">
                            <td>${student.studentId}</td>
                            <td>${student.studentName}</td>
                            <td>${student.semester}</td>
                            <td>${student.phone_number}</td>
                            <td>${student.email}</td>
                            <td>${student.dob}</td>
                            <td>${student.gender}</td>
                            <td><button class="btn btn-danger" onclick="deleteStudent('${student.studentId}')">Delete</button></td>
                        </tr>
                    `);
                }) : $('#studentList').append('<tr><td colspan="8">No students found.</td></tr>');
            }).fail(error => alert('Error: ' + error.responseText));
        }

        function deleteStudent(studentId) {
            if (!confirm('Are you sure?')) return;

            $.ajax({
                url: `${serverUrl}/delete-student/${studentId}`,
                type: 'DELETE',
                success: function(response) {
                    alert(response);
                    $(`#row-${studentId}`).remove();
                },
                error: function(error) {
                    alert('Error: ' + error.responseText);
                }
            });
        }
    </script>
</body>
</html>
