<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Student Management System</h1>

    <h2>Add Student</h2>
    <form id="studentForm">
        <label for="studentId">Student ID:</label>
        <input type="text" id="studentId" required><br><br>
        
        <label for="studentName">Student Name:</label>
        <input type="text" id="studentName" required><br><br>
        
        <label for="semester">Semester:</label>
        <input type="text" id="semester" required><br><br>
        
        <label for="phone_number">Phone Number:</label>
        <input type="text" id="phone_number" required><br><br>
        
        <label for="email">Email:</label>
        <input type="email" id="email" required><br><br>
        
        <label for="dob">Date of Birth:</label>
        <input type="date" id="dob" required><br><br>
        
        <label for="gender">Gender:</label>
        <select id="gender" required>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
        </select><br><br>
        
        <button type="button" onclick="addStudent()">Add Student</button>
    </form>

    <h2>Show Students</h2>
    <label for="showSemester">Select Semester:</label>
    <input type="text" id="showSemester" required>
    <button type="button" onclick="showStudents()">Show Students</button>

    <table id="studentList" border="1">
        <thead>
            <tr>
                <th>Student ID</th>
                <th>Student Name</th>
                <th>Semester</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Date of Birth</th>
                <th>Gender</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Student rows will be inserted here -->
        </tbody>
    </table>

    <script>
        const serverUrl = 'https://bldeacet.up.railway.app'; // Updated Railway app URL

        function addStudent() {
            const studentId = $('#studentId').val();
            const studentName = $('#studentName').val();
            const semester = $('#semester').val();
            const phone_number = $('#phone_number').val();
            const email = $('#email').val();
            const dob = $('#dob').val();
            const gender = $('#gender').val();

            if (studentId && studentName && semester && phone_number && email && dob && gender) {
                $.ajax({
                    url: `${serverUrl}/add-student`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ studentId, studentName, semester, phone_number, email, dob, gender }),
                    success: function(response) {
                        alert(response);
                        $('#studentForm')[0].reset(); // Clear the form
                        showStudents(); // Refresh student list
                    },
                    error: function(error) {
                        alert('Error: ' + error.responseText);
                    }
                });
            } else {
                alert('Please fill out all required fields.');
            }
        }

        function showStudents() {
            const semester = $('#showSemester').val();

            if (semester) {
                $.ajax({
                    url: `${serverUrl}/students/${semester}`,
                    type: 'GET',
                    success: function(students) {
                        $('#studentList').empty();  // Clear previous list
                        if (students.length > 0) {
                            students.forEach(student => {
                                $('#studentList').append(`
                                    <tr id="row-${student.studentId}">
                                        <td>${student.studentId}</td>
                                        <td>${student.studentName}</td>
                                        <td>${student.semester}</td>
                                        <td>${student.phone_number}</td>
                                        <td>${student.email}</td>
                                        <td>${student.dob}</td>
                                        <td>${student.gender}</td>
                                        <td><button class="btn btn-danger" onclick="deleteStudent('${student.studentId}')">Delete</button></td>
                                    </tr>
                                `);
                            });
                        } else {
                            $('#studentList').append('<tr><td colspan="8">No students found for this semester.</td></tr>');
                        }
                    },
                    error: function(error) {
                        alert('Error: ' + error.responseText);
                    }
                });
            } else {
                alert('Please select a semester.');
            }
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student?')) {
                $.ajax({
                    url: `${serverUrl}/delete-student/${studentId}`,
                    type: 'DELETE',
                    success: function(response) {
                        alert(response);
                        $(`#row-${studentId}`).remove(); // Remove row from table
                    },
                    error: function(error) {
                        alert('Error: ' + error.responseText);
                    }
                });
            }
        }
    </script>
</body>
</html>
