<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>Add Student</h2>
    <form id="studentForm">
        <input type="text" id="studentId" placeholder="Student ID" required>
        <input type="text" id="studentName" placeholder="Name" required>
        <input type="text" id="semester" placeholder="Semester" required>
        <input type="text" id="phone_number" placeholder="Phone Number" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="date" id="dob" required>
        <select id="gender">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
        <button type="button" onclick="addStudent()">Add Student</button>
    </form>

    <h2>View Students</h2>
    <select id="showSemester">
        <option value="">Select Semester</option>
        <option value="1">1st Semester</option>
        <option value="2">2nd Semester</option>
        <option value="3">3rd Semester</option>
    </select>
    <button onclick="showStudents()">Show Students</button>

    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Semester</th>
                <th>Phone</th>
                <th>Email</th>
                <th>DOB</th>
                <th>Gender</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="studentList"></tbody>
    </table>

    <script>
        const serverUrl = 'https://blde-production.up.railway.app'; // Your Railway URL

        function addStudent() {
            const student = {
                studentId: $('#studentId').val(),
                studentName: $('#studentName').val(),
                semester: $('#semester').val(),
                phone_number: $('#phone_number').val(),
                email: $('#email').val(),
                dob: $('#dob').val(),
                gender: $('#gender').val()
            };

            if (Object.values(student).every(value => value)) {
                $.post(`${serverUrl}/add-student`, JSON.stringify(student), function(response) {
                    alert(response);
                    $('#studentForm')[0].reset();
                    showStudents();
                }).fail(error => alert('Error: ' + error.responseText));
            } else {
                alert('Please fill all fields.');
            }
        }

        function showStudents() {
            const semester = $('#showSemester').val();
            if (semester) {
                $.get(`${serverUrl}/students/${semester}`, function(students) {
                    $('#studentList').empty();
                    if (students.length > 0) {
                        students.forEach(student => {
                            $('#studentList').append(`
                                <tr id="row-${student.studentId}">
                                    <td>${student.studentId}</td>
                                    <td>${student.studentName}</td>
                                    <td>${student.semester}</td>
                                    <td>${student.phone_number}</td>
                                    <td>${student.email}</td>
                                    <td>${student.dob}</td>
                                    <td>${student.gender}</td>
                                    <td><button onclick="deleteStudent('${student.studentId}')">Delete</button></td>
                                </tr>
                            `);
                        });
                    } else {
                        $('#studentList').append('<tr><td colspan="8">No students found.</td></tr>');
                    }
                }).fail(error => alert('Error: ' + error.responseText));
            } else {
                alert('Select a semester.');
            }
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure?')) {
                $.ajax({ url: `${serverUrl}/delete-student/${studentId}`, type: 'DELETE' })
                    .done(response => {
                        alert(response);
                        $(`#row-${studentId}`).remove();
                    }).fail(error => alert('Error: ' + error.responseText));
            }
        }
    </script>

</body>
</html>
